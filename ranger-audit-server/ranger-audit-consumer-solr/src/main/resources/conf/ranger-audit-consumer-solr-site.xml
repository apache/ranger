<!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->
<configuration>
    <!-- SOLR CONSUMER SERVICE CONFIGURATION -->
    <!-- Server Configuration (Health Check Endpoint) -->
    <property>
        <name>log.dir</name>
        <value>${audit.consumer.solr.log.dir}</value>
        <description>Log directory for Solr consumer service</description>
    </property>

    <property>
        <name>ranger.audit.consumer.solr.service.webapp.dir</name>
        <value>webapp/ranger-audit-consumer-solr</value>
        <description>Path to the extracted webapp directory</description>
    </property>

    <property>
        <name>ranger.audit.consumer.solr.service.contextName</name>
        <value>/</value>
    </property>

    <property>
        <name>ranger.audit.consumer.solr.service.host</name>
        <value>ranger-audit-consumer-solr.rangernw</value>
        <description>Service hostname</description>
    </property>

    <property>
        <name>ranger.audit.consumer.solr.service.http.port</name>
        <value>7091</value>
        <description>Health check endpoint port</description>
    </property>

    <!-- User for KERBEROS authentication into solr -->
    <property>
        <name>ranger.audit.service.authentication.method</name>
        <value>KERBEROS</value>
    </property>

    <property>
        <name>ranger.audit.service.host</name>
        <value>ranger-audit-consumer-solr.rangernw</value>
        <description>Hostname for resolving _HOST in Kerberos principal</description>
    </property>

    <property>
        <name>ranger.audit.service.kerberos.principal</name>
        <value>rangerauditserver/_HOST@EXAMPLE.COM</value>
        <description>Principal for Kafka consumer and Solr authentication</description>
    </property>

    <property>
        <name>ranger.audit.service.kerberos.keytab</name>
        <value>/etc/keytabs/rangerauditserver.keytab</value>
    </property>

    <!-- KAFKA CONSUMER CONFIGURATION -->
    <property>
        <name>xasecure.audit.destination.kafka.bootstrap.servers</name>
        <value>ranger-kafka:9092</value>
    </property>

    <property>
        <name>xasecure.audit.destination.kafka.topic.name</name>
        <value>ranger_audits</value>
    </property>

    <property>
        <name>xasecure.audit.destination.kafka.security.protocol</name>
        <value>SASL_PLAINTEXT</value>
    </property>

    <property>
        <name>xasecure.audit.destination.kafka.sasl.mechanism</name>
        <value>GSSAPI</value>
    </property>

    <!-- Solr Consumer Threading Configuration -->
    <property>
        <name>xasecure.audit.destination.kafka.consumer.thread.count</name>
        <value>5</value>
        <description>Number of Solr consumer worker threads (higher for indexing throughput)</description>
    </property>

    <!-- Offset Management -->
    <property>
        <name>xasecure.audit.destination.kafka.consumer.offset.commit.strategy</name>
        <value>batch</value>
        <description>batch or manual</description>
    </property>

    <property>
        <name>xasecure.audit.destination.kafka.consumer.offset.commit.interval.ms</name>
        <value>30000</value>
        <description>Used only if strategy is 'manual'</description>
    </property>

    <property>
        <name>xasecure.audit.destination.kafka.consumer.max.poll.records</name>
        <value>500</value>
        <description>Maximum records per poll for batch processing</description>
    </property>

    <!-- Solr Consumer Classes -->
    <property>
        <name>xasecure.audit.destination.kafka.consumer.classes</name>
        <value>org.apache.ranger.audit.consumer.kafka.AuditSolrConsumer</value>
    </property>

    <!-- SOLR DESTINATION CONFIGURATION - MUST BE ENABLED -->

    <property>
        <name>xasecure.audit.destination.solr</name>
        <value>true</value>
        <description>MUST be true for Solr consumer to work</description>
    </property>

    <property>
        <name>xasecure.audit.destination.solr.urls</name>
        <value>http://ranger-solr:8983/solr/ranger_audits</value>
        <description>
            Solr URLs for audits when SolrCloud is not enabled.
            Docker supports only standalone mode for now,
            configure http://ranger-solr:8983/solr/ranger_audits
        </description>
    </property>

    <property>
        <name>xasecure.audit.destination.solr.zookeepers</name>
        <value></value>
        <description>
            Zookeepers for Solr audit destination (SolrCloud mode).
            example: zookeeper-host1:2181,zookeeper-host2:2181,zookeeper-host3:2181
            In Docker, use: ranger-zk:2181/ranger_audits
        </description>
    </property>

    <property>
        <name>xasecure.audit.destination.solr.batch.filespool.dir</name>
        <value>/var/log/audit-consumer-solr/spool</value>
    </property>

    <!-- Solr Kerberos Authentication -->
    <property>
        <name>xasecure.audit.destination.solr.force.use.inmemory.jaas.config</name>
        <value>true</value>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.loginModuleName</name>
        <value>com.sun.security.auth.module.Krb5LoginModule</value>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.loginModuleControlFlag</name>
        <value>required</value>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.option.useKeyTab</name>
        <value>true</value>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.option.storeKey</name>
        <value>true</value>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.option.useTicketCache</name>
        <value>true</value>
        <description>Allow use of cached Kerberos tickets for Solr authentication</description>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.option.serviceName</name>
        <value>solr</value>
        <description>Kerberos service name for Solr</description>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.option.principal</name>
        <value>rangerauditserver/_HOST@EXAMPLE.COM</value>
        <description>Principal for Solr authentication</description>
    </property>

    <property>
        <name>xasecure.audit.jaas.Client.option.keyTab</name>
        <value>/etc/keytabs/rangerauditserver.keytab</value>
        <description>Keytab for Solr authentication</description>
    </property>
</configuration>
